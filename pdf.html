<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI PDF Summarizer ğŸ“‘</title>
    <link rel="stylesheet" href="style_pdf.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
</head>

<body>
    <header class="header">
        <div class="brand">
            <span>ğŸ“‘</span> AI PDF ìš”ì•½ê¸°
        </div>
        <div class="api-status-badge" onclick="openKeyModal()" id="apiStatus">
            ğŸ”’ API í‚¤ ì„¤ì • í•„ìš”
        </div>
    </header>

    <div class="main-container">
        <!-- 1. Upload Area -->
        <section class="upload-section">
            <div class="upload-zone" id="dropZone">
                <div class="upload-icon">ğŸ“„</div>
                <h3>PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</h3>
                <p style="color: #64748B; margin-top: 8px;">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</p>
                <button class="upload-btn">íŒŒì¼ ì„ íƒí•˜ê¸°</button>
                <input type="file" id="fileInput" accept=".pdf" hidden>
            </div>
        </section>

        <!-- 2. Result Area -->
        <section class="result-section">
            <div class="result-header">
                <h3 style="font-size: 1rem; color: #334155;">ë¶„ì„ ê²°ê³¼</h3>
                <button class="upload-btn" onclick="copyToClipboard()"
                    style="padding: 6px 12px; font-size: 0.9rem; background: #64748B;">
                    ğŸ“‹ ë³µì‚¬
                </button>
            </div>

            <div class="result-content" id="resultContent">
                <div style="text-align: center; color: #94A3B8; margin-top: 100px;">
                    ì™¼ìª½ íŒ¨ë„ì—ì„œ PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´<br>
                    AIê°€ í•µì‹¬ ë‚´ìš©ì„ ìš”ì•½í•´ë“œë¦½ë‹ˆë‹¤. ğŸ§ 
                </div>
            </div>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                <span class="loader"></span>
                <p id="statusMessage">ë¬¸ì„œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
        </section>
    </div>

    <!-- API Key Modal -->
    <div class="modal-backdrop" id="keyModal" style="display: none;">
        <div class="modal-box">
            <h3 style="margin-bottom: 8px;">ğŸ”‘ API í‚¤ ì„¤ì •</h3>
            <p style="font-size: 0.9rem; color: #64748B;">
                Google Gemini ëª¨ë¸ ì‚¬ìš©ì„ ìœ„í•´ OpenRouter API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                <a href="https://openrouter.ai/keys" target="_blank" style="color: var(--primary);">í‚¤ ë°œê¸‰ë°›ê¸°</a>
            </p>
            <input type="password" id="apiKeyInput" class="input-full" placeholder="sk-or-v1-...">
            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                <button onclick="closeKeyModal()"
                    style="padding: 8px 16px; border: 1px solid #E2E8F0; background: white; border-radius: 6px; cursor: pointer;">ì·¨ì†Œ</button>
                <button onclick="saveKeyFromModal()"
                    style="padding: 8px 16px; border: none; background: var(--primary); color: white; border-radius: 6px; cursor: pointer;">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script src="app_pdf.js?v=3"></script>
    <script>
        // UI & Event Logic (Frontend Dev & QA)

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const resultContent = document.getElementById('resultContent');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const apiStatus = document.getElementById('apiStatus');
        const keyModal = document.getElementById('keyModal');

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            updateApiStatusUI();

            // Drag & Drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) handleFileUpload(files[0]);
            });

            // Click Upload
            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) handleFileUpload(e.target.files[0]);
            });
        });

        // UI Helpers
        function setLoading(isLoading) {
            loadingOverlay.style.display = isLoading ? 'flex' : 'none';
        }

        function showResultSection(show) {
            // Mobile responsive logic could go here
        }

        function renderResult(markdown) {
            resultContent.innerHTML = marked.parse(markdown);
        }

        function updateApiStatusUI() {
            const hasKey = !!localStorage.getItem('openrouter_api_key');
            if (hasKey) {
                apiStatus.classList.add('active');
                apiStatus.textContent = 'âš¡ AI Ready';
            } else {
                apiStatus.classList.remove('active');
                apiStatus.textContent = 'ğŸ”’ API í‚¤ ì„¤ì • í•„ìš”';
            }
        }

        async function copyToClipboard() {
            const text = resultContent.innerText;
            if (!text || text.includes('ì™¼ìª½ íŒ¨ë„ì—ì„œ')) return;
            try {
                await navigator.clipboard.writeText(text);
                alert('ìš”ì•½ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (err) {
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Modal
        function openKeyModal() {
            keyModal.style.display = 'flex';
            document.getElementById('apiKeyInput').value = localStorage.getItem('openrouter_api_key') || '';
        }
        function closeKeyModal() { keyModal.style.display = 'none'; }
        function saveKeyFromModal() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                saveApiKey(key);
                closeKeyModal();
                alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>

</html>